-- Place this LocalScript in StarterGui

local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = workspace.CurrentCamera

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "NpcLockGui"
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 60)
frame.Position = UDim2.new(0, 100, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local frameCorner = Instance.new("UICorner")
frameCorner.CornerRadius = UDim.new(0, 12)
frameCorner.Parent = frame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(0, 120, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Npc Lock"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 24
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = frame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0, 50, 0, 40)
toggleBtn.Position = UDim2.new(0, 140, 0.5, -20)
toggleBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 22
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Parent = frame

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 10)
buttonCorner.Parent = toggleBtn

local isLocked = false
local oldCameraSubject = nil

local function updateButton()
    if isLocked then
        toggleBtn.Text = "ON"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
    else
        toggleBtn.Text = "OFF"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
    end
end

local function isAlive(npc)
    local humanoid = npc:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health > 0
end

local function getNearestAliveNPC()
    local minDist = math.huge
    local nearestNPC = nil
    local playerChar = player.Character
    if not playerChar or not playerChar.PrimaryPart then return nil end
    local playerPos = playerChar.PrimaryPart.Position

    for _, npc in ipairs(workspace:GetChildren()) do
        if npc:IsA("Model") and npc ~= player.Character and isAlive(npc) then
            local head = npc:FindFirstChild("Head")
            if head then
                local dist = (playerPos - head.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    nearestNPC = npc
                end
            end
        end
    end
    return nearestNPC
end

local function lockCameraToNPC()
    local npc = getNearestAliveNPC()
    if npc and npc:FindFirstChild("Head") then
        oldCameraSubject = camera.CameraSubject
        camera.CameraSubject = npc.Head
    else
        isLocked = false
        updateButton()
    end
end

local function unlockCamera()
    if oldCameraSubject then
        camera.CameraSubject = oldCameraSubject
        oldCameraSubject = nil
    else
        if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
            camera.CameraSubject = player.Character:FindFirstChildOfClass("Humanoid")
        end
    end
end

toggleBtn.MouseButton1Click:Connect(function()
    isLocked = not isLocked
    updateButton()
    if isLocked then
        lockCameraToNPC()
    else
        unlockCamera()
    end
end)

updateButton()
